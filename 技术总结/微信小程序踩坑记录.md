## 安卓与ios的异常

> 同一份代码在安卓和ios上的异常记录

### chooseLocation未授权的报错

```js
chooseLocation: function (options) {
    let that = this;
    wx.chooseLocation({
    success: function (res) {
        typeof options.success === 'function' && options.success(res);
    },
    cancel: options.cancel,
    fail: function(res){
        /**
        * chooseLocation在安卓和ios上的差异
        * 未授权：
        * 安卓：errMsg:"getLocation:fail auth deny"
        * 苹果：errMsg:"getLocation:fail authorize no response"
        */
        if (res.errMsg.includes('chooseLocation:fail')){
        that.showModal({
            content: '您之前拒绝授权我们使用您的定位，致使我们无法定位，是否重新授权定位？',
            showCancel: true,
            cancelText: "否",
            confirmText: "是",
            confirm: function () {
            wx.openSetting({
                success: function (res) {
                if (res.authSetting['scope.userLocation'] === true) {
                    that.chooseLocation(options);
                }
                }
            })
            },
            cancel: function () {
            typeof options.fail === 'function' && options.fail();
            }
        })
        } else {
        typeof options.fail === 'function' && options.fail();
        }
    }
    });
},
```

## 真机异常

> 在模拟器正常，在真机异常记录

### canvas不断点击绘制会不断放大

```js
data: {
    isCanvasMax: false, // 第二次绘制不需要缩放坐标
},
...
initCanvas(res) {
const {width, height, node} = res[0]
const ctx = node.getContext('2d')
const dpr = wx.getSystemInfoSync().pixelRatio
node.width = width * dpr
node.height = height * dpr
// 第二次绘制不需要缩放坐标
if(!this.data.isCanvasMax){
    ctx.scale(dpr, dpr)
    this.setData({
    isCanvasMax: true
    })
}
this.setData({ "canvas": node })
this.drawShareImg()
},
```